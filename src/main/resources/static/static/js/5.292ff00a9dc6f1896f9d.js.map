{"version":3,"sources":["webpack:///src/views/chat/components/ChatDialog.vue","webpack:///./src/views/chat/components/ChatDialog.vue?7417","webpack:///./src/views/chat/components/ChatDialog.vue","webpack:///./src/views/chat/index.vue?826a","webpack:///./src/views/chat/index.vue","webpack:///./src/api/chat.js","webpack:///src/views/chat/index.vue","webpack:///./node_modules/core-js/library/fn/object/values.js","webpack:///./node_modules/core-js/library/modules/es7.object.values.js","webpack:///./node_modules/babel-runtime/core-js/object/values.js","webpack:///./node_modules/core-js/library/modules/_object-to-array.js"],"names":["ChatDialog","name","props","chatMessage","type","Array","person","defaultAvatar","watch","console","log","this","scrollToBottom","mounted","methods","$nextTick","div","document","getElementById","scrollTop","scrollHeight","components_ChatDialog","render","_vm","_h","$createElement","_c","_self","directives","rawName","value","length","expression","ref","staticClass","attrs","id","_l","item","toPerson","justify","span","fromPerson","src","avatar","friend","_v","staticStyle","margin-left","_s","context","line-height","element-loading-spinner","offset","padding-left","staticRenderFns","chat_components_ChatDialog","__webpack_require__","normalizeComponent","ssrContext","views_chat","size","width","placeholder","prefix-icon","tab-position","on","tab-click","selectTab","model","callback","$$v","activeTag","label","height","data","friendTable","show-header","fit","empty-text","empty","contact","highlight-current-row","row-click","selectToChat","prop","scopedSlots","_u","key","fn","scope","row","unRead","_e","groupTable","group","noRead","margin-bottom","rows","message","click","sendMessage","__vue_styles__","Component","chat","__webpack_exports__","Object","__WEBPACK_IMPORTED_MODULE_0__utils_request__","url","method","__WEBPACK_IMPORTED_MODULE_1_qs___default","a","stringify","ids","components","__WEBPACK_IMPORTED_MODULE_2__components__","currentSendChat","sendTime","currentReceiveChat","currentChatId","socket","_this","JSON","parse","sessionStorage","getItem","__WEBPACK_IMPORTED_MODULE_3__api_chat__","then","res","initWebSocket","tab","event","column","_this2","fromPersonId","toPersonId","i","window","WebSocket","onopen","open","onerror","error","onmessage","getMessage","alert","__WEBPACK_IMPORTED_MODULE_5_element_ui__","duration","msg","eval","isSendFromCurrentFriend","undefined","loading","Date","send","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default","push","close","me","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_values___default","module","exports","values","$export","$values","S","it","default","__esModule","getKeys","toIObject","isEnum","f","isEntries","O","keys","result","call"],"mappings":"6EAwCA,IAAAA,GACAC,KAAA,aACAC,OACAC,aACAC,KAAAC,OAEAC,UACAC,kBAEAC,OAEAL,YAFA,WAGAM,QAAAC,IAAAC,KAAAR,aACAQ,KAAAC,mBAGAC,QAhBA,WAiBAF,KAAAC,kBAEAE,SAEAF,eAFA,WAGAD,KAAAI,UAAA,WACA,IAAAC,EAAAC,SAAAC,eAAA,UACAF,EAAAG,UAAAH,EAAAI,kBC7DAC,GADiBC,OAFjB,WAA0B,IAAAC,EAAAZ,KAAaa,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,QAAAA,EAAA,MAA2BE,aAAa3B,KAAA,OAAA4B,QAAA,SAAAC,MAAAP,EAAApB,YAAA4B,OAAA,EAAAC,WAAA,yBAAgGC,IAAA,SAAAC,YAAA,UAAAC,OAA4CC,GAAA,WAAeb,EAAAc,GAAAd,EAAA,qBAAAe,GAAyC,OAAAZ,EAAA,MAAAY,EAAAC,SAAAH,KAAAb,EAAAjB,OAAA8B,GAAAV,EAAA,UAAgEQ,YAAA,SAAAC,OAA4B/B,KAAA,OAAAoC,QAAA,WAAiCd,EAAA,UAAeS,OAAOM,KAAA,KAAUH,EAAAI,WAAA,OAAAhB,EAAA,OAAqCQ,YAAA,MAAAC,OAAyBQ,IAAAL,EAAAI,WAAAE,UAA8BlB,EAAA,OAAYQ,YAAA,MAAAC,OAAyBQ,IAAApB,EAAAhB,cAAAsC,YAAgCtB,EAAAuB,GAAA,KAAApB,EAAA,UAA6BqB,aAAaC,cAAA,QAAqBb,OAAQM,KAAA,MAAWf,EAAA,OAAYQ,YAAA,QAAkBR,EAAA,QAAAH,EAAAuB,GAAAvB,EAAA0B,GAAAX,EAAAY,gBAAA3B,EAAAuB,GAAA,KAAApB,EAAA,UAAyES,OAAOM,KAAA,KAAUf,EAAA,OAAYE,aAAa3B,KAAA,UAAA4B,QAAA,YAAAC,MAAAQ,EAAA,QAAAN,WAAA,iBAAkFe,aAAeI,cAAA,QAAqBhB,OAAQiB,0BAAA,wBAA6C,GAAA1B,EAAA,UAAqBQ,YAAA,KAAAC,OAAwB/B,KAAA,OAAAoC,QAAA,SAA+Bd,EAAA,UAAeS,OAAOM,KAAA,EAAAY,OAAA,MAAsB3B,EAAA,OAAYE,aAAa3B,KAAA,UAAA4B,QAAA,YAAAC,MAAAQ,EAAA,QAAAN,WAAA,iBAAkFe,aAAeI,cAAA,QAAqBhB,OAAQiB,0BAAA,uBAA6C7B,EAAAuB,GAAA,KAAApB,EAAA,UAA6BS,OAAOM,KAAA,MAAWf,EAAA,OAAYQ,YAAA,QAAkBR,EAAA,QAAAH,EAAAuB,GAAAvB,EAAA0B,GAAAX,EAAAY,gBAAA3B,EAAAuB,GAAA,KAAApB,EAAA,UAAyEqB,aAAaO,eAAA,QAAsBnB,OAAQM,KAAA,KAAUH,EAAAI,WAAA,OAAAhB,EAAA,OAAqCQ,YAAA,MAAAC,OAAyBQ,IAAAL,EAAAI,WAAAE,UAA8BlB,EAAA,OAAYQ,YAAA,MAAAC,OAAyBQ,IAAApB,EAAAhB,cAAAsC,aAAgC,YAAY,IAEprDU,oBCCjB,IAuBAC,EAvBAC,EAAA,OAcAC,CACA1D,EACAqB,GATA,EAVA,SAAAsC,GACAF,EAAA,SAaA,kBAEA,MAUA,mKCvBAG,GADiBtC,OAFjB,WAA0B,IAAAC,EAAAZ,KAAaa,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAAA,EAAA,UAA8BQ,YAAA,mBAA6BR,EAAA,UAAeQ,YAAA,UAAAC,OAA6BM,KAAA,KAAUf,EAAA,WAAgBQ,YAAA,SAAAC,OAA4B0B,KAAA,UAAenC,EAAA,gBAAqBS,OAAO2B,MAAA,UAAgBpC,EAAA,YAAiBS,OAAO4B,YAAA,KAAAC,cAAA,qBAAmD,OAAAzC,EAAAuB,GAAA,KAAApB,EAAA,WAAoCS,OAAO8B,eAAA,OAAqBC,IAAKC,YAAA5C,EAAA6C,WAA0BC,OAAQvC,MAAAP,EAAA,UAAA+C,SAAA,SAAAC,GAA+ChD,EAAAiD,UAAAD,GAAkBvC,WAAA,eAAyBN,EAAA,eAAoBS,OAAOsC,MAAA,MAAAxE,KAAA,WAA8ByB,EAAA,YAAiBqB,aAAae,MAAA,OAAAY,OAAA,QAA+BvC,OAAQwC,KAAApD,EAAAqD,YAAAC,eAAA,EAAAC,KAAA,EAAAC,aAAAxD,EAAAyD,MAAAC,QAAAC,yBAAA,GAAmHhB,IAAKiB,YAAA5D,EAAA6D,gBAA8B1D,EAAA,mBAAwBS,OAAOkD,KAAA,SAAAvB,MAAA,MAA6BwB,YAAA/D,EAAAgE,KAAsBC,IAAA,UAAAC,GAAA,SAAAC,GAAiC,OAAAA,EAAAC,IAAA9C,OAAA,OAAAnB,EAAA,OAA4CS,OAAOQ,IAAA+C,EAAAC,IAAA9C,OAAAD,UAA+BlB,EAAA,OAAYS,OAAOQ,IAAApB,EAAAhB,cAAAsC,iBAAuCtB,EAAAuB,GAAA,KAAApB,EAAA,mBAAoCS,OAAOkD,KAAA,OAAAvB,MAAA,OAA4BwB,YAAA/D,EAAAgE,KAAsBC,IAAA,UAAAC,GAAA,SAAAC,GAAiC,OAAAnE,EAAAuB,GAAAvB,EAAA0B,GAAAyC,EAAAC,IAAA1F,cAA4CsB,EAAAuB,GAAA,KAAApB,EAAA,mBAAoCS,OAAOkD,KAAA,UAAgBC,YAAA/D,EAAAgE,KAAsBC,IAAA,UAAAC,GAAA,SAAAC,GAAiC,OAAAA,EAAAC,IAAA,OAAAjE,EAAA,UAAAH,EAAAuB,GAAAvB,EAAA0B,GAAAyC,EAAAC,IAAAC,WAAArE,EAAAsE,aAAyF,OAAAtE,EAAAuB,GAAA,KAAApB,EAAA,eAAwCS,OAAOsC,MAAA,KAAAxE,KAAA,YAA8ByB,EAAA,YAAiBqB,aAAae,MAAA,OAAAY,OAAA,QAA+BvC,OAAQwC,KAAApD,EAAAuE,WAAAjB,eAAA,EAAAC,KAAA,EAAAC,aAAAxD,EAAAyD,MAAAe,SAAoFrE,EAAA,mBAAwBS,OAAOkD,KAAA,SAAAvB,MAAA,MAA6BwB,YAAA/D,EAAAgE,KAAsBC,IAAA,UAAAC,GAAA,SAAAC,GAAiC,OAAAA,EAAAC,IAAA9C,OAAA,OAAAnB,EAAA,OAA4CS,OAAOQ,IAAA+C,EAAAC,IAAA9C,OAAAD,UAA+BlB,EAAA,OAAYS,OAAOQ,IAAApB,EAAAhB,cAAAwF,gBAAsCxE,EAAAuB,GAAA,KAAApB,EAAA,mBAAoCS,OAAOkD,KAAA,OAAAvB,MAAA,SAA6BvC,EAAAuB,GAAA,KAAApB,EAAA,mBAAoCS,OAAOkD,KAAA,WAAiBC,YAAA/D,EAAAgE,KAAsBC,IAAA,UAAAC,GAAA,SAAAC,GAAiC,OAAAA,EAAAC,IAAAK,OAAA,EAAAtE,EAAA,UAAAH,EAAAuB,GAAAvB,EAAA0B,GAAAyC,EAAAC,IAAAK,WAAAzE,EAAAsE,aAA2F,eAAAtE,EAAAuB,GAAA,KAAApB,EAAA,UAA2CQ,YAAA,WAAAC,OAA8BM,KAAA,MAAWf,EAAA,UAAeqB,aAAa2B,OAAA,MAAAuB,gBAAA,UAAuCvE,EAAA,eAAoBS,OAAOhC,YAAAoB,EAAApB,YAAAG,OAAAiB,EAAAjB,OAAAC,cAAAgB,EAAAhB,kBAAqF,GAAAgB,EAAAuB,GAAA,KAAApB,EAAA,UAA+BqB,aAAa2B,OAAA,SAAgBhD,EAAA,YAAiBS,OAAO/B,KAAA,WAAA8F,KAAA,EAAAnC,YAAA,UAAkDM,OAAQvC,MAAAP,EAAA,QAAA+C,SAAA,SAAAC,GAA6ChD,EAAA4E,QAAA5B,GAAgBvC,WAAA,aAAuBT,EAAAuB,GAAA,KAAApB,EAAA,aAA8BQ,YAAA,aAAAC,OAAgC/B,KAAA,UAAAyD,KAAA,UAAiCK,IAAKkC,MAAA7E,EAAA8E,eAAyB9E,EAAAuB,GAAA,yBAEpxFS,oBCCjB,IASA+C,EAZA,SAAA3C,GACAF,EAAA,SAgBA8C,EAdA9C,EAAA,OAcAC,CACA8C,EAAA,EACA5C,GATA,EAWA0C,EAPA,KAEA,MAUAG,EAAA,QAAAF,EAAA,+CCtBO,SAAmBnE,GACxB,OAAOsE,OAAAC,EAAA,EAAAD,EACLE,IAAI,cACJC,OAAO,OACVlC,KAAKmC,EAAAC,EAAGC,UAAU5E,UAIZ,SAAwB6E,GAC7B,OAAOP,OAAAC,EAAA,EAAAD,EACLE,IAAI,mBACJC,OAAO,OACTlC,KAAKmC,EAAAC,EAAGC,UAAUC,UAYb,SAAiBA,GACtB,OAAOP,OAAAC,EAAA,EAAAD,EACLE,IAAI,oBACJC,OAAO,OACTlC,KAAKmC,EAAAC,EAAGC,UAAUC,8lCC+CpBR,oBAAA,GACAxG,KAAA,QACAiH,YACAlH,WAAAmH,0CAAA,GAEAxC,KALA,WAMA,OACApE,eACAsC,OAAA,iNACAkD,MAAA,qNAEAf,OACAC,QAAA,QACAc,MAAA,QAEAzF,UACAH,eACAiH,iBACA1E,cACAH,YACAW,QAAA,GACAmE,SAAA,IAEAC,oBACA5E,cACAH,YACAW,QAAA,GACAmE,SAAA,IAEAlB,QAAA,GACA3B,UAAA,QACAI,eACAkB,cACAyB,cAAA,GACAC,OAAA,KAGA3G,QArCA,WAqCA,IAAA4G,EAAA9G,KACAA,KAAAL,OAAAoH,KAAAC,MAAAC,eAAAC,QAAA,WACAnB,OAAAoB,wCAAA,EAAApB,CAAA/F,KAAAL,QAAAyH,KAAA,SAAAC,GACAP,EAAA7C,YAAAoD,EAAArD,KACAlE,QAAAC,IAAA+G,EAAA7C,eAGAjE,KAAAsH,iBAEAnH,SAEAsD,UAFA,SAEA8D,EAAAC,GACA1H,QAAAC,IAAAwH,EAAAC,IAGA/C,aANA,SAMAO,EAAAwC,EAAAC,GAAA,IAAAC,EAAA1H,KACA,GAAAgF,EAAAvD,IAAAzB,KAAA4G,cAAA,CAGA5G,KAAA4G,cAAA5B,EAAAvD,GAEAzB,KAAAyG,gBAAA1E,WAAAiD,EAAArF,OACAK,KAAAyG,gBAAA7E,SAAAoD,EAAA9C,OAEA6D,OAAAoB,wCAAA,EAAApB,EAAA4B,aAAA3H,KAAAL,OAAA8B,GAAAmG,WAAA5C,EAAA9C,OAAAT,KAAA2F,KAAA,SAAAC,GACAK,EAAAlI,YAAA6H,EAAArD,OAGA,QAAA6D,EAAA,EAAAA,EAAA7H,KAAAiE,YAAA7C,OAAAyG,IACA,GAAA7H,KAAAiE,YAAA4D,GAAA3F,OAAAT,IAAAuD,EAAA9C,OAAAT,GAAA,CACAzB,KAAAiE,YAAA4D,GAAA5C,OAAA,EACA,MAGAjF,KAAAwF,QAAA,KAEA8B,cA3BA,WA6BA,cAAAQ,QAEA9H,KAAA6G,OAAA,IAAAkB,UAAA,8BAAA/H,KAAAL,OAAA8B,IAEAzB,KAAA6G,OAAAmB,OAAAhI,KAAAiI,KAEAjI,KAAA6G,OAAAqB,QAAAlI,KAAAmI,MAEAnI,KAAA6G,OAAAuB,UAAApI,KAAAqI,YAEAC,MAAA,6BAGAL,KAAA,WACAnI,QAAAC,IAAA,eAEAoI,MAAA,WACApC,OAAAwC,yCAAA,QAAAxC,EACAP,QAAA,cACA/F,KAAA,QACA+I,SAAA,OAIAH,WAAA,SAAAA,WAAAI,KACAzI,KAAA2G,mBAAA+B,KAAA,IAAAD,IAAAzE,KAAA,KACAhE,KAAA2I,2BAGAjD,YAAA,gBACAkD,GAAA5I,KAAAyG,gBAAA7E,SAAAH,GACAsE,OAAAwC,yCAAA,QAAAxC,EACAP,QAAA,UACA/F,KAAA,QACA+I,SAAA,OAGAxI,KAAAyG,gBAAAoC,SAAA,EACA7I,KAAAyG,gBAAAC,SAAA,IAAAoC,KACA9I,KAAAyG,gBAAAlE,QAAAvC,KAAAwF,QACAxF,KAAA6G,OAAAkC,KAAAC,6EAAAhJ,KAAAyG,kBACAzG,KAAAyG,gBAAAoC,SAAA,EACA7I,KAAAR,YAAAyJ,KAAAjJ,KAAAyG,iBACAzG,KAAAR,YAAAuH,KAAAC,MAAAgC,6EAAAhJ,KAAAR,cACAQ,KAAAwF,QAAA,KAGA0D,MAAA,WACAnD,OAAAwC,yCAAA,QAAAxC,EACAP,QAAA,oBACA/F,KAAA,QACA+I,SAAA,OAIAG,wBApFA,WA4FA,MAAA3I,KAAA2G,mBAAAwC,IAEA,QAAAtB,EAAA7H,KAAAR,YAAA4B,OAAA,EAAAyG,EAAA,EAAAA,IACA,GAAA7H,KAAA2G,mBAAAD,UAAA1G,KAAAR,YAAAqI,GAAAnB,UACA1G,KAAA2G,mBAAApE,SAAAvC,KAAAR,YAAAqI,GAAAtF,QAAA,CACAvC,KAAAR,YAAAqI,GAAAgB,SAAA,EACA,YAIA,OAAAO,4EAAApJ,KAAAyG,iBAAArF,QAAApB,KAAA2G,mBAAA5E,WAAAN,IAAAzB,KAAAyG,gBAAA7E,SAAAH,IACA,IAAAoG,EAAA,EAAAA,EAAA7H,KAAAiE,YAAA7C,OAAAyG,IACA,GAAA7H,KAAA2G,mBAAA5E,WAAAN,IAAAzB,KAAAiE,YAAA4D,GAAA3F,OAAAT,GAAA,CACAzB,KAAAiE,YAAA4D,GAAA5C,QAAA,EACA,YAIAjF,KAAAR,YAAAyJ,KAAAjJ,KAAA2G,oBACAZ,OAAAoB,wCAAA,EAAApB,EAAA4B,aAAA3H,KAAA2G,mBAAA/E,SAAAH,GAAAmG,WAAA5H,KAAA2G,mBAAA5E,WAAAN,KAAA2F,KAAA,SAAAC,GACAvH,QAAAC,IAAA,iCC7OA+C,EAAA,QACAuG,EAAAC,QAAAxG,EAAA,QAAAiD,OAAAwD,6BCAA,IAAAC,EAAA1G,EAAA,QACA2G,EAAA3G,EAAA,OAAAA,EAAA,GAEA0G,IAAAE,EAAA,UACAH,OAAA,SAAAI,GACA,OAAAF,EAAAE,4BCNAN,EAAAC,SAAkBM,QAAA9G,EAAA,QAAA+G,YAAA,yBCAlB,IAAAC,EAAAhH,EAAA,QACAiH,EAAAjH,EAAA,QACAkH,EAAAlH,EAAA,QAAAmH,EACAZ,EAAAC,QAAA,SAAAY,GACA,gBAAAP,GAOA,IANA,IAKA9E,EALAsF,EAAAJ,EAAAJ,GACAS,EAAAN,EAAAK,GACA/I,EAAAgJ,EAAAhJ,OACAyG,EAAA,EACAwC,KAEAjJ,EAAAyG,GAAAmC,EAAAM,KAAAH,EAAAtF,EAAAuF,EAAAvC,OACAwC,EAAApB,KAAAiB,GAAArF,EAAAsF,EAAAtF,IAAAsF,EAAAtF,IACK,OAAAwF","file":"static/js/5.292ff00a9dc6f1896f9d.js","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<template>\r\n\t\t\t<ul v-show=\"chatMessage.length>0\" class=\"chat-ul\" ref=\"chatul\" id=\"chatul\">\r\n\t\t\t\t<li v-for=\"item in chatMessage\">\r\n\t\t\t\t\t<el-row v-if=\"item.toPerson.id===person.id\" class=\"friend\" type=\"flex\" justify=\"start\">\r\n\t\t\t\t\t\t<el-col :span=\"1\">\r\n\t\t\t\t\t\t\t<img v-if=\"item.fromPerson.avatar\" :src=\"item.fromPerson.avatar\" class=\"img\">\r\n\t\t\t\t\t\t\t<img v-else :src=\"defaultAvatar.friend\" class=\"img\">\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t\t<el-col :span=\"10\" style=\"margin-left: 15px;\">\r\n\t\t\t\t\t\t\t<div class=\"msg\">\r\n\t\t\t\t\t\t\t\t<span>{{item.context}}</span>\r\n\t\t\t\t\t\t\t</div>\t\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t\t<el-col :span=\"1\">\r\n\t\t\t\t\t\t\t<div v-loading=\"item.loading\" element-loading-spinner=\"el-icon-loading\"  style=\"line-height: 80px;\"></div>\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t</el-row>\r\n\t\t\t\t\t<el-row v-else class=\"me\" type=\"flex\" justify=\"end\">\r\n\t\t\t\t\t\t<el-col :span=\"1\" :offset=\"12\">\r\n\t\t\t\t\t\t\t<div v-loading=\"item.loading\" element-loading-spinner=\"el-icon-loading\"  style=\"line-height: 80px;\"></div>\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t\t<el-col :span=\"10\" >\r\n\t\t\t\t\t\t\t<div class=\"msg\" >\r\n\t\t\t\t\t\t\t\t<span>{{item.context}}</span>\r\n\t\t\t\t\t\t\t</div>\t\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t\t<el-col :span=\"1\" style=\"padding-left: 10px;\">\r\n\t\t\t\t\t\t\t<img v-if=\"item.fromPerson.avatar\" :src=\"item.fromPerson.avatar\" class=\"img\">\r\n\t\t\t\t\t\t\t<img v-else :src=\"defaultAvatar.friend\" class=\"img\">\r\n\t\t\t\t\t\t</el-col>\r\n\t\t\t\t\t</el-row>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</template>\r\n\t</div>\r\n</template>\n\n<script>\r\n\texport default{\r\n\t\tname:'chatDialog',\r\n\t\tprops:{\r\n\t\t\tchatMessage:{  //聊天记录\n\t\t\t  type: Array\n\t\t\t},\r\n\t\t\tperson:{}, //自己的信息\r\n\t\t\tdefaultAvatar:{}  //默认头像\r\n\t\t},\r\n\t\twatch:{\r\n\t\t\t//聊天记录改变时触发滚动条方法\r\n\t\t\tchatMessage(){\r\n\t\t\t\tconsole.log(this.chatMessage)\r\n\t\t\t\tthis.scrollToBottom()\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted(){\r\n\t\t\tthis.scrollToBottom()\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t//滚动条置于底部\r\n\t\t\tscrollToBottom(){\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t             var div = document.getElementById('chatul')\r\n\t\t             div.scrollTop = div.scrollHeight\r\n\t\t\t     })\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</script>\n\n<style scoped=\"scoped\">\r\n\t.chat-ul{\r\n\t\toverflow-y: scroll;\r\n\t\theight: 490px;\r\n\t}\r\n\t.chat-ul li{\r\n\t\tlist-style: none;\r\n\t\twidth: 100%;\r\n\t}\r\n\t.chat-ul li div{\r\n\t\tmargin-bottom: 5px;\r\n\t}\r\n\t.chat-ul li img{\r\n\t\tborder-radius: 50%;\r\n\t\twidth:40px;\r\n\t\theight: 40px;\r\n\t}\r\n\t.chat-ul li .msg{\r\n\t\tborder-radius: 20px;\r\n\t\tbox-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);\r\n\t\tbackground-color:#cdcdcd ;\r\n\t\tpadding: 10px;\r\n\t}\r\n\t.friend{\r\n\t}\r\n\t.me{\r\n\t\tmargin-right: 50px;\r\n\t}\r\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/views/chat/components/ChatDialog.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[[_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.chatMessage.length>0),expression:\"chatMessage.length>0\"}],ref:\"chatul\",staticClass:\"chat-ul\",attrs:{\"id\":\"chatul\"}},_vm._l((_vm.chatMessage),function(item){return _c('li',[(item.toPerson.id===_vm.person.id)?_c('el-row',{staticClass:\"friend\",attrs:{\"type\":\"flex\",\"justify\":\"start\"}},[_c('el-col',{attrs:{\"span\":1}},[(item.fromPerson.avatar)?_c('img',{staticClass:\"img\",attrs:{\"src\":item.fromPerson.avatar}}):_c('img',{staticClass:\"img\",attrs:{\"src\":_vm.defaultAvatar.friend}})]),_vm._v(\" \"),_c('el-col',{staticStyle:{\"margin-left\":\"15px\"},attrs:{\"span\":10}},[_c('div',{staticClass:\"msg\"},[_c('span',[_vm._v(_vm._s(item.context))])])]),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":1}},[_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(item.loading),expression:\"item.loading\"}],staticStyle:{\"line-height\":\"80px\"},attrs:{\"element-loading-spinner\":\"el-icon-loading\"}})])],1):_c('el-row',{staticClass:\"me\",attrs:{\"type\":\"flex\",\"justify\":\"end\"}},[_c('el-col',{attrs:{\"span\":1,\"offset\":12}},[_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(item.loading),expression:\"item.loading\"}],staticStyle:{\"line-height\":\"80px\"},attrs:{\"element-loading-spinner\":\"el-icon-loading\"}})]),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":10}},[_c('div',{staticClass:\"msg\"},[_c('span',[_vm._v(_vm._s(item.context))])])]),_vm._v(\" \"),_c('el-col',{staticStyle:{\"padding-left\":\"10px\"},attrs:{\"span\":1}},[(item.fromPerson.avatar)?_c('img',{staticClass:\"img\",attrs:{\"src\":item.fromPerson.avatar}}):_c('img',{staticClass:\"img\",attrs:{\"src\":_vm.defaultAvatar.friend}})])],1)],1)}))]],2)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-3441cbce\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/chat/components/ChatDialog.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-3441cbce\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ChatDialog.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ChatDialog.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ChatDialog.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3441cbce\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./ChatDialog.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-3441cbce\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/chat/components/ChatDialog.vue\n// module id = null\n// module chunks = ","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-row',{staticClass:\"chat-container\"},[_c('el-col',{staticClass:\"left-ul\",attrs:{\"span\":6}},[_c('el-form',{staticClass:\"search\",attrs:{\"size\":\"mini\"}},[_c('el-form-item',{attrs:{\"width\":\"70px\"}},[_c('el-input',{attrs:{\"placeholder\":\"搜索\",\"prefix-icon\":\"el-icon-search\"}})],1)],1),_vm._v(\" \"),_c('el-tabs',{attrs:{\"tab-position\":\"top\"},on:{\"tab-click\":_vm.selectTab},model:{value:(_vm.activeTag),callback:function ($$v) {_vm.activeTag=$$v},expression:\"activeTag\"}},[_c('el-tab-pane',{attrs:{\"label\":\"联系人\",\"name\":\"first\"}},[_c('el-table',{staticStyle:{\"width\":\"100%\",\"height\":\"100%\"},attrs:{\"data\":_vm.friendTable,\"show-header\":false,\"fit\":false,\"empty-text\":_vm.empty.contact,\"highlight-current-row\":true},on:{\"row-click\":_vm.selectToChat}},[_c('el-table-column',{attrs:{\"prop\":\"avatar\",\"width\":\"40\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(scope.row.friend.avatar)?_c('img',{attrs:{\"src\":scope.row.friend.avatar}}):_c('img',{attrs:{\"src\":_vm.defaultAvatar.friend}})]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"name\",\"width\":\"212\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_vm._v(_vm._s(scope.row.name))]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"unRead\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(scope.row.unRead)?_c('el-tag',[_vm._v(_vm._s(scope.row.unRead))]):_vm._e()]}}])})],1)],1),_vm._v(\" \"),_c('el-tab-pane',{attrs:{\"label\":\"群聊\",\"name\":\"second\"}},[_c('el-table',{staticStyle:{\"width\":\"100%\",\"height\":\"100%\"},attrs:{\"data\":_vm.groupTable,\"show-header\":false,\"fit\":false,\"empty-text\":_vm.empty.group}},[_c('el-table-column',{attrs:{\"prop\":\"avatar\",\"width\":\"40\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(scope.row.friend.avatar)?_c('img',{attrs:{\"src\":scope.row.friend.avatar}}):_c('img',{attrs:{\"src\":_vm.defaultAvatar.group}})]}}])}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"name\",\"width\":\"200\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"message\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(scope.row.noRead>0)?_c('el-tag',[_vm._v(_vm._s(scope.row.noRead))]):_vm._e()]}}])})],1)],1)],1)],1),_vm._v(\" \"),_c('el-col',{staticClass:\"right-ul\",attrs:{\"span\":18}},[_c('el-row',{staticStyle:{\"height\":\"70%\",\"margin-bottom\":\"10px\"}},[_c('chat-dialog',{attrs:{\"chatMessage\":_vm.chatMessage,\"person\":_vm.person,\"defaultAvatar\":_vm.defaultAvatar}})],1),_vm._v(\" \"),_c('el-row',{staticStyle:{\"height\":\"30%\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":6,\"placeholder\":\"输入聊天内容\"},model:{value:(_vm.message),callback:function ($$v) {_vm.message=$$v},expression:\"message\"}}),_vm._v(\" \"),_c('el-button',{staticClass:\"my-send-bt\",attrs:{\"type\":\"success\",\"size\":\"medium\"},on:{\"click\":_vm.sendMessage}},[_vm._v(\"发送\")])],1)],1)],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-6a1ae291\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/chat/index.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-6a1ae291\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./index.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./index.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-6a1ae291\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./index.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/chat/index.vue\n// module id = null\n// module chunks = ","import request from '@/utils/request'\r\nimport Qs from 'qs'\r\n\n/* info */\r\nexport function getFriend(id) {\n  return request({\n    url:'/friend/get',\n    method:'post',\r\n\tdata:Qs.stringify(id)\n  })\n}\r\n\r\nexport function getChatMessage(ids) {\n  return request({\n    url:'/chatMessage/get',\n    method:'post',\r\n\t\tdata:Qs.stringify(ids)\n  })\n}\r\n\r\nexport function sendMessage(chatMessage) {\n  return request({\n    url:'/chatMessage/send',\n    method:'post',\r\n\t\tdata:chatMessage\n  })\n}\r\n/* 将消息设为已读 */\r\nexport function setRead(ids) {\n  return request({\n    url:'/chatMessage/read',\n    method:'post',\r\n\t\tdata:Qs.stringify(ids)\n  })\n}\n\n\n// WEBPACK FOOTER //\n// ./src/api/chat.js","<template>\r\n\t<div>\r\n\t\t<el-row class=\"chat-container\">\r\n\t\t\t<!--联系人-->\r\n\t\t\t <el-col :span=\"6\" class=\"left-ul\">\r\n\t\t\t\t <el-form size=\"mini\" class=\"search\">\r\n\t\t\t\t\t <el-form-item width=\"70px\">\r\n\t\t\t\t\t\t <el-input placeholder=\"搜索\" prefix-icon=\"el-icon-search\"></el-input>\r\n\t\t\t\t\t </el-form-item>\r\n\t\t\t\t </el-form>\r\n\t\t\t\t<el-tabs v-model=\"activeTag\" @tab-click=\"selectTab\" tab-position=\"top\">\r\n\t\t\t\t\t<el-tab-pane label=\"联系人\" name=\"first\">\r\n\t\t\t\t\t\t<el-table\r\n\t\t\t\t\t\t\t  :data=\"friendTable\"\r\n\t\t\t\t\t\t\t  style=\"width: 100%;height: 100%;\"\r\n\t\t\t\t\t\t\t  :show-header=\"false\"\r\n\t\t\t\t\t\t\t  :fit=\"false\"\r\n\t\t\t\t\t\t\t  @row-click=\"selectToChat\"\r\n\t\t\t\t\t\t\t  :empty-text=\"empty.contact\"\r\n\t\t\t\t\t\t\t  :highlight-current-row=\"true\">\r\n\t\t\t\t\t\t\t  <el-table-column prop=\"avatar\" width=\"40\">\r\n\t\t\t\t\t\t\t\t <template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t <img v-if=\"scope.row.friend.avatar\" :src=\"scope.row.friend.avatar\" />\r\n\t\t\t\t\t\t\t\t\t <img v-else :src=\"defaultAvatar.friend\"/>\r\n\t\t\t\t\t\t\t\t </template>\r\n\t\t\t\t\t\t\t  </el-table-column>\r\n\t\t\t\t\t\t\t  <el-table-column prop=\"name\" width=\"212\">\r\n\t\t\t\t\t\t\t\t  <template slot-scope=\"scope\">{{scope.row.name}}</template>\r\n\t\t\t\t\t\t\t  </el-table-column>\r\n\t\t\t\t\t\t\t  <el-table-column prop=\"unRead\">\r\n\t\t\t\t\t\t\t\t  <template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t  <el-tag v-if=\"scope.row.unRead\">{{scope.row.unRead}}</el-tag>\r\n\t\t\t\t\t\t\t\t  </template>\r\n\t\t\t\t\t\t\t  </el-table-column>\r\n\t\t\t\t\t\t\t</el-table>\r\n\t\t\t\t\t</el-tab-pane>\r\n\t\t\t\t\t<el-tab-pane label=\"群聊\" name=\"second\">\r\n\t\t\t\t\t\t<el-table\r\n\t\t\t\t\t\t\t  :data=\"groupTable\"\r\n\t\t\t\t\t\t\t  style=\"width: 100%;height: 100%;\"\r\n\t\t\t\t\t\t\t  :show-header=\"false\"\r\n\t\t\t\t\t\t\t  :fit=\"false\"\r\n\t\t\t\t\t\t\t  :empty-text=\"empty.group\">\r\n\t\t\t\t\t\t\t  <el-table-column prop=\"avatar\" width=\"40\">\r\n\t\t\t\t\t\t\t\t <template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t <img v-if=\"scope.row.friend.avatar\" :src=\"scope.row.friend.avatar\" />\r\n\t\t\t\t\t\t\t\t\t <img v-else :src=\"defaultAvatar.group\"/>\r\n\t\t\t\t\t\t\t\t </template>\r\n\t\t\t\t\t\t\t  </el-table-column>\r\n\t\t\t\t\t\t\t  <el-table-column prop=\"name\" width=\"200\">\r\n\t\t\t\t\t\t\t  </el-table-column>\r\n\t\t\t\t\t\t\t  <el-table-column prop=\"message\">\r\n\t\t\t\t\t\t\t\t  <template slot-scope=\"scope\">\r\n\t\t\t\t\t\t\t\t\t  <el-tag v-if=\"scope.row.noRead>0\">{{scope.row.noRead}}</el-tag>\r\n\t\t\t\t\t\t\t\t  </template>\r\n\t\t\t\t\t\t\t  </el-table-column>\r\n\t\t\t\t\t\t\t</el-table>\r\n\t\t\t\t\t</el-tab-pane>\r\n\t\t\t\t</el-tabs>\r\n\t\t\t </el-col>\r\n\t\t\t <!--聊天信息框-->\r\n\t\t\t <el-col :span=\"18\" class=\"right-ul\">\r\n\t\t\t\t <el-row style=\"height: 70%;margin-bottom: 10px;\">\r\n\t\t\t\t\t <chat-dialog  :chatMessage=\"chatMessage\"  :person=\"person\" :defaultAvatar=\"defaultAvatar\"></chat-dialog>\r\n\t\t\t\t </el-row>\r\n\t\t\t\t <el-row style=\"height: 30%;\">\r\n\t\t\t\t\t <el-input type=\"textarea\" :rows=\"6\" v-model=\"message\" placeholder=\"输入聊天内容\"></el-input>\r\n\t\t\t\t\t <el-button type=\"success\" @click=\"sendMessage\" size=\"medium\" class=\"my-send-bt\">发送</el-button>\r\n\t\t\t\t </el-row>\r\n\t\t\t </el-col>\r\n\t\t</el-row>\r\n\t</div>\n</template>\n\n<script>\r\n\timport {ChatDialog} from './components'\r\n\timport {getFriend,getChatMessage,sendMessage,setRead} from '@/api/chat'\r\n\timport Qs from 'qs'\r\n\timport { Message } from 'element-ui'\r\n\texport default{\r\n\t\tname:'index',\r\n\t\tcomponents: {\r\n\t\t\tChatDialog\r\n\t\t},\r\n\t\tdata(){\r\n\t\t\treturn{\r\n\t\t\t\tdefaultAvatar:{\r\n\t\t\t\t\tfriend:'https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570773046879&di=0164a258a87ab4ffcd79ca4ac1673e8d&imgtype=0&src=http%3A%2F%2Fimg.zcool.cn%2Fcommunity%2F01786557e4a6fa0000018c1bf080ca.png',\r\n\t\t\t\t\tgroup:'https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570773226840&di=c3fa724d81bed3e1a1e78cb09593b4c9&imgtype=0&src=http%3A%2F%2Fpic.90sjimg.com%2Fdesign%2F00%2F67%2F59%2F63%2F58e8ebdd5c471.png'\r\n\t\t\t\t},\r\n\t\t\t\tempty:{\r\n\t\t\t\t\tcontact:'暂无联系人',\r\n\t\t\t\t\tgroup:'暂无群聊'\r\n\t\t\t\t},\r\n\t\t\t\tperson:{},\r\n\t\t\t\tchatMessage:[], //总聊天记录，传递到ChatDialog页面\r\n\t\t\t\tcurrentSendChat:{  //当前聊天，用来发送消息\r\n\t\t\t\t\tfromPerson:{},\r\n\t\t\t\t\ttoPerson:{},\r\n\t\t\t\t\tcontext:'',\r\n\t\t\t\t\tsendTime:''\r\n\t\t\t\t}, \r\n\t\t\t\t currentReceiveChat:{  //当前接收的消息，不一定是来自当前聊天的好友\r\n\t\t\t\t \tfromPerson:{},\r\n\t\t\t\t \ttoPerson:{},\r\n\t\t\t\t \tcontext:'',\r\n\t\t\t\t \tsendTime:''\r\n\t\t\t\t },\r\n\t\t\t\tmessage:'',\r\n\t\t\t\tactiveTag: 'first',\r\n\t\t\t\tfriendTable:[],\r\n\t\t\t\tgroupTable:[],\r\n\t\t\t\tcurrentChatId:'',  //当前聊天id，非好友的id\r\n\t\t\t\tsocket:''\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted(){\r\n\t\t\tthis.person = JSON.parse(sessionStorage.getItem(\"person\")) //获取本地个人信息\r\n\t\t\tgetFriend(this.person).then(res=>{  //获取联系人\r\n\t\t\t\tthis.friendTable = res.data \r\n\t\t\t\tconsole.log(this.friendTable)\r\n\t\t\t})\r\n\t\t\t //连接webSocket\r\n\t\t\tthis.initWebSocket();\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t//选择联系人或群聊列表\r\n\t\t\tselectTab(tab, event) {\r\n\t\t\t\tconsole.log(tab, event);\r\n\t\t\t  },\r\n\t\t\t  //选择聊天联系人\r\n\t\t\t selectToChat(row, event, column){\r\n\t\t\t\t if(row.id == this.currentChatId){  //如果是点击当前聊天好友，则直接返回，不用请求数据\r\n\t\t\t\t\t return;   \r\n\t\t\t\t }\r\n\t\t\t\t this.currentChatId = row.id\r\n\t\t\t\t //设置当前聊天双方\r\n\t\t\t\t this.currentSendChat.fromPerson = row.person\r\n\t\t\t\t this.currentSendChat.toPerson = row.friend\r\n\t\t\t\t //获取聊天信息\r\n\t\t\t\t getChatMessage({fromPersonId:this.person.id,toPersonId:row.friend.id}).then(res=>{\r\n\t\t\t\t\t this.chatMessage = res.data\r\n\t\t\t\t })\r\n\t\t\t\t //将未读消息清空\r\n\t\t\t\t for(var i=0;i<this.friendTable.length;i++){\r\n\t\t\t\t\t if(this.friendTable[i].friend.id == row.friend.id){\r\n\t\t\t\t\t\t this.friendTable[i].unRead = 0;\r\n\t\t\t\t\t\t break;\r\n\t\t\t\t\t }\r\n\t\t\t\t }\r\n\t\t\t\t this.message=\"\"  //清空输入框\r\n\t\t\t },\r\n\t\t\t initWebSocket(){\r\n\t\t\t\t //连接webSocket\r\n\t\t\t\t if ('WebSocket' in window) {\r\n\t\t\t\t\t\t// 实例化socket\r\n\t\t\t\t\tthis.socket = new WebSocket('ws://localhost/socket/chat/'+this.person.id)\r\n\t\t\t\t\t// 监听socket连接\r\n\t\t\t\t\tthis.socket.onopen = this.open\r\n\t\t\t\t\t// 监听socket错误信息\r\n\t\t\t\t\tthis.socket.onerror = this.error\r\n\t\t\t\t\t// 监听socket消息\r\n\t\t\t\t\tthis.socket.onmessage = this.getMessage\r\n\t\t\t\t   } else {\r\n\t\t\t\t \talert('当前浏览器不支持websocket，无法建立聊天')\r\n\t\t\t\t   }\r\n\t\t\t },\r\n\t\t\t open: function () {\r\n\t\t\t\tconsole.log(\"socket连接成功\")\r\n\t\t\t},\r\n\t\t\terror: function () {\r\n\t\t\t\tMessage({\r\n\t\t\t\t  message: \"webSocket出错\",\r\n\t\t\t\t  type: 'error',\r\n\t\t\t\t  duration: 3 * 1000\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//获取消息\r\n\t\t\tgetMessage: function (msg) {\r\n\t\t\t\tthis.currentReceiveChat = eval('('+msg.data+')')\r\n\t\t\t\tthis.isSendFromCurrentFriend();\r\n\t\t\t},\r\n\t\t\t//发送消息\r\n\t\t\tsendMessage: function () {\r\n\t\t\t\tif(this.currentSendChat.toPerson.id==undefined){\r\n\t\t\t\t\tMessage({\r\n\t\t\t\t\t  message: \"请选择聊天对象\",\r\n\t\t\t\t\t  type: 'error',\r\n\t\t\t\t\t  duration: 3 * 1000\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.currentSendChat.loading = false  //清空进度条再上传\r\n\t\t\t\t\tthis.currentSendChat.sendTime = new Date()\r\n\t\t\t\t\tthis.currentSendChat.context = this.message\r\n\t\t\t\t\tthis.socket.send(JSON.stringify(this.currentSendChat))  //发送消息到后台\r\n\t\t\t\t\tthis.currentSendChat.loading = true   //进度条一定要在发送之后\r\n\t\t\t\t\tthis.chatMessage.push(this.currentSendChat) //将消息推送到聊天框\r\n\t\t\t\t\tthis.chatMessage =  JSON.parse(JSON.stringify(this.chatMessage)) //对象是引用类型\r\n\t\t\t\t\tthis.message=\"\"\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclose: function () {\r\n\t\t\t\tMessage({\r\n\t\t\t\t  message: \"请刷新浏览器连接webSocket\",\r\n\t\t\t\t  type: 'error',\r\n\t\t\t\t  duration: 3 * 1000\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//判断接收的消息是否是当前聊天好友发送的\r\n\t\t\tisSendFromCurrentFriend(){\r\n\t\t\t\t/**\r\n\t\t\t\t * Object.keys()把对象的key转换为数组， Object.values()把对象的值转换为数组\r\n\t\t\t\t * let person = {name:\"张三\",age:25,address:\"深圳\",getName:function(){}}\r\n\t\t\t\t\tObject.keys(person) // [\"name\", \"age\", \"address\",\"getName\"]\r\n\t\t\t\t\tObject.values(person) // [\"张三\", 25, \"深圳\",\"function\"]\r\n\t\t\t\t */\r\n\t\t\t\t//此消息是自己发送的\r\n\t\t\t\tif(this.currentReceiveChat.me == 1){ \r\n\t\t\t\t\t\t\t\t//从后向前查找此消息（因为刚发的消息一般都是在最后面）\r\n\t\t\t\t\t\t\t\tfor(var i=this.chatMessage.length-1;i>0;i--){\r\n\t\t\t\t\t\t\t\t\tif(this.currentReceiveChat.sendTime == this.chatMessage[i].sendTime\r\n\t\t\t\t\t\t\t\t\t\t&&this.currentReceiveChat.context == this.chatMessage[i].context){\r\n\t\t\t\t\t\t\t\t\t\tthis.chatMessage[i].loading = false\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t//未选择聊天或当前聊天不是发送信息的那个好友，则显示未读消息\r\n\t\t\t\t}else if(Object.values(this.currentSendChat).length !== 0 && this.currentReceiveChat.fromPerson.id != this.currentSendChat.toPerson.id){\r\n\t\t\t\t\tfor(var i=0;i<this.friendTable.length;i++){\r\n\t\t\t\t\t\tif(this.currentReceiveChat.fromPerson.id == this.friendTable[i].friend.id){\r\n\t\t\t\t\t\t\tthis.friendTable[i].unRead+=1;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{  //如果当前聊天是来自当前正在聊天的好友，则显示消息，并且将消息设为已读\r\n\t\t\t\t\tthis.chatMessage.push(this.currentReceiveChat)\r\n\t\t\t\t\tsetRead({fromPersonId:this.currentReceiveChat.toPerson.id,toPersonId:this.currentReceiveChat.fromPerson.id}).then(res=>{\r\n\t\t\t\t\t\tconsole.log(\"已读\")\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</script>\n\n<style>\r\n\t.chat-container{\r\n\t\theight: 700px;\r\n\t}\r\n\t.left-ul{\r\n\t\tbackground: #eeeef2;\r\n\t\tborder-right: 1px solid #99a9bf;\r\n\t\tborder-bottom: 1px solid #99a9bf;\r\n\t\theight: 100%;\r\n\t\tline-height: 100%;\r\n\t}\r\n\t.left-ul img{\r\n\t\tborder-radius: 50%;\r\n\t\theight:30px;\r\n\t\twidth:30px\r\n\t}\r\n\t.search{\r\n\t\tmargin-top: 10px;\r\n\t\tmargin-left: 10px;\r\n\t\tmargin-right: 10px;\r\n\t}\r\n\t/*重写tab的样式*/\r\n\t.el-tabs__nav{\r\n\t\tmargin-left: 15px;\r\n\t}\r\n\t.right-ul{\r\n\t\theight: 100%;\r\n\t}\r\n\t/*重写textarea的样式*/\r\n\t.el-textarea__inner{\r\n\t\tborder-radius: 0px;\r\n\t\tborder-bottom: 0px;\r\n\t\tborder-left: 0px;\r\n\t\tborder-right: 0px;\r\n\t}\r\n\t.my-send-bt{\r\n\t\tposition: absolute;\r\n\t\tright: 10px;\r\n\t\tbottom: 3px;\r\n\t}\r\n\t.chat-dialog-ul{\r\n\t\tlist-style: none;\r\n\t}\r\n\t.chat-dialog-ul li{\r\n\t\twidth:50px;\r\n\t}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/views/chat/index.vue","require('../../modules/es7.object.values');\nmodule.exports = require('../../modules/_core').Object.values;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/object/values.js\n// module id = TmV0\n// module chunks = 5","// https://github.com/tc39/proposal-object-values-entries\nvar $export = require('./_export');\nvar $values = require('./_object-to-array')(false);\n\n$export($export.S, 'Object', {\n  values: function values(it) {\n    return $values(it);\n  }\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/modules/es7.object.values.js\n// module id = fZOM\n// module chunks = 5","module.exports = { \"default\": require(\"core-js/library/fn/object/values\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/object/values.js\n// module id = gRE1\n// module chunks = 5","var getKeys = require('./_object-keys');\nvar toIObject = require('./_to-iobject');\nvar isEnum = require('./_object-pie').f;\nmodule.exports = function (isEntries) {\n  return function (it) {\n    var O = toIObject(it);\n    var keys = getKeys(O);\n    var length = keys.length;\n    var i = 0;\n    var result = [];\n    var key;\n    while (length > i) if (isEnum.call(O, key = keys[i++])) {\n      result.push(isEntries ? [key, O[key]] : O[key]);\n    } return result;\n  };\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/modules/_object-to-array.js\n// module id = mbce\n// module chunks = 5"],"sourceRoot":""}