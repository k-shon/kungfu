webpackJsonp([5],{"/LD5":function(e,t){},"/qry":function(e,t,a){"use strict";var s={name:"chatDialog",props:{chatMessage:{type:Array},person:{},defaultAvatar:{}},watch:{chatMessage:function(){console.log(this.chatMessage),this.scrollToBottom()}},mounted:function(){this.scrollToBottom()},methods:{scrollToBottom:function(){this.$nextTick(function(){var e=document.getElementById("chatul");e.scrollTop=e.scrollHeight})}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[[a("ul",{directives:[{name:"show",rawName:"v-show",value:e.chatMessage.length>0,expression:"chatMessage.length>0"}],ref:"chatul",staticClass:"chat-ul",attrs:{id:"chatul"}},e._l(e.chatMessage,function(t){return a("li",[t.toPerson.id===e.person.id?a("el-row",{staticClass:"friend",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:1}},[t.fromPerson.avatar?a("img",{staticClass:"img",attrs:{src:t.fromPerson.avatar}}):a("img",{staticClass:"img",attrs:{src:e.defaultAvatar.friend}})]),e._v(" "),a("el-col",{staticStyle:{"margin-left":"15px"},attrs:{span:10}},[a("div",{staticClass:"msg"},[a("span",[e._v(e._s(t.context))])])]),e._v(" "),a("el-col",{attrs:{span:1}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"item.loading"}],staticStyle:{"line-height":"80px"},attrs:{"element-loading-spinner":"el-icon-loading"}})])],1):a("el-row",{staticClass:"me",attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:1,offset:12}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"item.loading"}],staticStyle:{"line-height":"80px"},attrs:{"element-loading-spinner":"el-icon-loading"}})]),e._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"msg"},[a("span",[e._v(e._s(t.context))])])]),e._v(" "),a("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:1}},[t.fromPerson.avatar?a("img",{staticClass:"img",attrs:{src:t.fromPerson.avatar}}):a("img",{staticClass:"img",attrs:{src:e.defaultAvatar.friend}})])],1)],1)}))]],2)},staticRenderFns:[]};var n=a("VU/8")(s,r,!1,function(e){a("/LD5")},"data-v-3441cbce",null).exports;a.d(t,"a",function(){return n})},"3ep+":function(e,t){},HVFi:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("QA3a"),r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticClass:"chat-container"},[a("el-col",{staticClass:"left-ul",attrs:{span:6}},[a("el-form",{staticClass:"search",attrs:{size:"mini"}},[a("el-form-item",{attrs:{width:"70px"}},[a("el-input",{attrs:{placeholder:"搜索","prefix-icon":"el-icon-search"}})],1)],1),e._v(" "),a("el-tabs",{attrs:{"tab-position":"top"},on:{"tab-click":e.selectTab},model:{value:e.activeTag,callback:function(t){e.activeTag=t},expression:"activeTag"}},[a("el-tab-pane",{attrs:{label:"联系人",name:"first"}},[a("el-table",{staticStyle:{width:"100%",height:"100%"},attrs:{data:e.friendTable,"show-header":!1,fit:!1,"empty-text":e.empty.contact,"highlight-current-row":!0},on:{"row-click":e.selectToChat}},[a("el-table-column",{attrs:{prop:"avatar",width:"40"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.friend.avatar?a("img",{attrs:{src:t.row.friend.avatar}}):a("img",{attrs:{src:e.defaultAvatar.friend}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",width:"212"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"unRead"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.unRead?a("el-tag",[e._v(e._s(t.row.unRead))]):e._e()]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"群聊",name:"second"}},[a("el-table",{staticStyle:{width:"100%",height:"100%"},attrs:{data:e.groupTable,"show-header":!1,fit:!1,"empty-text":e.empty.group}},[a("el-table-column",{attrs:{prop:"avatar",width:"40"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.friend.avatar?a("img",{attrs:{src:t.row.friend.avatar}}):a("img",{attrs:{src:e.defaultAvatar.group}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{prop:"message"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.noRead>0?a("el-tag",[e._v(e._s(t.row.noRead))]):e._e()]}}])})],1)],1)],1)],1),e._v(" "),a("el-col",{staticClass:"right-ul",attrs:{span:18}},[a("el-row",{staticStyle:{height:"70%","margin-bottom":"10px"}},[a("chat-dialog",{attrs:{chatMessage:e.chatMessage,person:e.person,defaultAvatar:e.defaultAvatar}})],1),e._v(" "),a("el-row",{staticStyle:{height:"30%"}},[a("el-input",{attrs:{type:"textarea",rows:6,placeholder:"输入聊天内容"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),e._v(" "),a("el-button",{staticClass:"my-send-bt",attrs:{type:"success",size:"medium"},on:{click:e.sendMessage}},[e._v("发送")])],1)],1)],1)],1)},staticRenderFns:[]};var n=function(e){a("3ep+")},i=a("VU/8")(s.a,r,!1,n,null,null);t.default=i.exports},Pi6f:function(e,t,a){"use strict";t.b=function(e){return Object(s.a)({url:"/friend/get",method:"post",data:n.a.stringify(e)})},t.a=function(e){return Object(s.a)({url:"/chatMessage/get",method:"post",data:n.a.stringify(e)})},t.c=function(e){return Object(s.a)({url:"/chatMessage/read",method:"post",data:n.a.stringify(e)})};var s=a("vLgD"),r=a("mw3O"),n=a.n(r)},QA3a:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_values__=__webpack_require__("gRE1"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_values___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_values__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_2__components__=__webpack_require__("/qry"),__WEBPACK_IMPORTED_MODULE_3__api_chat__=__webpack_require__("Pi6f"),__WEBPACK_IMPORTED_MODULE_4_qs__=__webpack_require__("mw3O"),__WEBPACK_IMPORTED_MODULE_4_qs___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_qs__),__WEBPACK_IMPORTED_MODULE_5_element_ui__=__webpack_require__("zL8q"),__WEBPACK_IMPORTED_MODULE_5_element_ui___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_element_ui__);__webpack_exports__.a={name:"index",components:{ChatDialog:__WEBPACK_IMPORTED_MODULE_2__components__.a},data:function(){return{defaultAvatar:{friend:"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570773046879&di=0164a258a87ab4ffcd79ca4ac1673e8d&imgtype=0&src=http%3A%2F%2Fimg.zcool.cn%2Fcommunity%2F01786557e4a6fa0000018c1bf080ca.png",group:"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1570773226840&di=c3fa724d81bed3e1a1e78cb09593b4c9&imgtype=0&src=http%3A%2F%2Fpic.90sjimg.com%2Fdesign%2F00%2F67%2F59%2F63%2F58e8ebdd5c471.png"},empty:{contact:"暂无联系人",group:"暂无群聊"},person:{},chatMessage:[],currentSendChat:{fromPerson:{},toPerson:{},context:"",sendTime:""},currentReceiveChat:{fromPerson:{},toPerson:{},context:"",sendTime:""},message:"",activeTag:"first",friendTable:[],groupTable:[],currentChatId:"",socket:""}},mounted:function(){var e=this;this.person=JSON.parse(sessionStorage.getItem("person")),Object(__WEBPACK_IMPORTED_MODULE_3__api_chat__.b)(this.person).then(function(t){e.friendTable=t.data,console.log(e.friendTable)}),this.initWebSocket()},methods:{selectTab:function(e,t){console.log(e,t)},selectToChat:function(e,t,a){var s=this;if(e.id!=this.currentChatId){this.currentChatId=e.id,this.currentSendChat.fromPerson=e.person,this.currentSendChat.toPerson=e.friend,Object(__WEBPACK_IMPORTED_MODULE_3__api_chat__.a)({fromPersonId:this.person.id,toPersonId:e.friend.id}).then(function(e){s.chatMessage=e.data});for(var r=0;r<this.friendTable.length;r++)if(this.friendTable[r].friend.id==e.friend.id){this.friendTable[r].unRead=0;break}this.message=""}},initWebSocket:function(){"WebSocket"in window?(this.socket=new WebSocket("ws://localhost/socket/chat/"+this.person.id),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage):alert("当前浏览器不支持websocket，无法建立聊天")},open:function(){console.log("socket连接成功")},error:function(){Object(__WEBPACK_IMPORTED_MODULE_5_element_ui__.Message)({message:"webSocket出错",type:"error",duration:3e3})},getMessage:function getMessage(msg){this.currentReceiveChat=eval("("+msg.data+")"),this.isSendFromCurrentFriend()},sendMessage:function(){void 0==this.currentSendChat.toPerson.id?Object(__WEBPACK_IMPORTED_MODULE_5_element_ui__.Message)({message:"请选择聊天对象",type:"error",duration:3e3}):(this.currentSendChat.loading=!1,this.currentSendChat.sendTime=new Date,this.currentSendChat.context=this.message,this.socket.send(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(this.currentSendChat)),this.currentSendChat.loading=!0,this.chatMessage.push(this.currentSendChat),this.chatMessage=JSON.parse(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_json_stringify___default()(this.chatMessage)),this.message="")},close:function(){Object(__WEBPACK_IMPORTED_MODULE_5_element_ui__.Message)({message:"请刷新浏览器连接webSocket",type:"error",duration:3e3})},isSendFromCurrentFriend:function(){if(1==this.currentReceiveChat.me){for(var e=this.chatMessage.length-1;e>0;e--)if(this.currentReceiveChat.sendTime==this.chatMessage[e].sendTime&&this.currentReceiveChat.context==this.chatMessage[e].context){this.chatMessage[e].loading=!1;break}}else if(0!==__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_values___default()(this.currentSendChat).length&&this.currentReceiveChat.fromPerson.id!=this.currentSendChat.toPerson.id){for(e=0;e<this.friendTable.length;e++)if(this.currentReceiveChat.fromPerson.id==this.friendTable[e].friend.id){this.friendTable[e].unRead+=1;break}}else this.chatMessage.push(this.currentReceiveChat),Object(__WEBPACK_IMPORTED_MODULE_3__api_chat__.c)({fromPersonId:this.currentReceiveChat.toPerson.id,toPersonId:this.currentReceiveChat.fromPerson.id}).then(function(e){console.log("已读")})}}}},TmV0:function(e,t,a){a("fZOM"),e.exports=a("FeBl").Object.values},fZOM:function(e,t,a){var s=a("kM2E"),r=a("mbce")(!1);s(s.S,"Object",{values:function(e){return r(e)}})},gRE1:function(e,t,a){e.exports={default:a("TmV0"),__esModule:!0}},mbce:function(e,t,a){var s=a("lktj"),r=a("TcQ7"),n=a("NpIQ").f;e.exports=function(e){return function(t){for(var a,i=r(t),_=s(i),o=_.length,c=0,l=[];o>c;)n.call(i,a=_[c++])&&l.push(e?[a,i[a]]:i[a]);return l}}}});
//# sourceMappingURL=5.292ff00a9dc6f1896f9d.js.map